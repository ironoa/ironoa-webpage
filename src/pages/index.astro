---
import Base from '../layouts/Base.astro';
import { getCollection } from 'astro:content';

const pageTitle = 'ironoa â€” Independent Polkadot & Kusama Validator';
const desc = 'Independent validator services from Switzerland with bare-metal hardware, redundancy, and strong operational practices.';

const all = await getCollection('news', ({ data }) => !data.draft);
const posts = all.sort((a, b) => (a.data.date < b.data.date ? 1 : -1));

// Helper function to extract plain text from markdown
function getExcerpt(body: string, maxLength = 200): string {
  // Remove markdown headers
  let text = body.replace(/^#+\s+(.*)$/gm, '$1');
  // Remove markdown links but keep the text: [text](url) -> text
  text = text.replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1');
  // Remove bold/italic markers
  text = text.replace(/[*_]{1,2}([^*_]+)[*_]{1,2}/g, '$1');
  // Get first paragraph
  text = text.split('\n\n')[0];
  // Truncate
  if (text.length > maxLength) {
    text = text.substring(0, maxLength) + '...';
  }
  return text;
}
---
<Base title={pageTitle} description={desc}>
  <h1 class="h1"><img src="/green-tick-icon.jpg" alt="Verified" style="width: 32px; height: 32px; display: inline-block; vertical-align: middle; margin-right: 0.5rem;" /> ALESSIO aka ironoa</h1>
  <p class="lede">Independent Polkadot & Kusama Validator</p>

  <h2 class="h2" style="margin-top: 2rem;"><i class="mdi mdi-newspaper-variant-outline"></i> News & Updates</h2>
  
  <div class="news-cards">
    {posts.map(p => (
      <article class="news-card">
        <div class="news-date muted">{p.data.date}</div>
        <h3 class="news-title">{p.data.title}</h3>
        <div class="news-excerpt">
          {getExcerpt(p.body)}
        </div>
        <a href={`/news/${p.slug}/`} class="btn" style="margin-top: 0.75rem;">
          <i class="mdi mdi-open-in-new"></i> Read more
        </a>
      </article>
    ))}
  </div>

</Base>
